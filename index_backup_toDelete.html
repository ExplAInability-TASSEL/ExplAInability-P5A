<!-- section menu de la page -->
<div id="nav-menu">
    <ul>
        <!-- lien hypertextes qui renvoient vers les sections dont l'ID est #menu, #infos et #contact. A DEFINIR -->
        <!-- <li><a href="#menu" style="text-decoration: none; color: #fff;">Menu</a></li> -->
        <li><a href="#infos" style="text-decoration: none; color: #fff;">Infos</a></li>
        <li><a href="#contact" style="text-decoration: none; color: #fff;">Contact</a></li>
    </ul>
</div>

// recupérer les coordonnées des segments à partir du fichier JSON water (requête fetch)
            fetch('./sources/training_segment_lat_long.json')
                // convertit la réponse en JSON
                .then(response => response.json())
                // traitement des données récupérées
                .then(data => {
                    // Loop through the data and create polygons for each area
                    data.forEach((areaData) => {
                        const polygonCoordinates = areaData.perimeter_pixel_coordinates.map(coord => ({
                            lat: parseFloat(coord.latitude),
                            lng: parseFloat(coord.longitude),
                            intensity: parseFloat(coord.intensity)
                        }));

                        const areaColor = getColorFromClass(areaData.class_id);

                        // Create a polygon with ordered coordinates
                        const polygon = new google.maps.Polygon({
                            paths: polygonCoordinates,
                            map: map,
                            strokeColor: areaColor,
                            strokeOpacity: 1,
                            strokeWeight: 2,
                            fillColor: areaColor,
                            fillOpacity: 0.2
                        });

                        // Add click event listener to the polygon
                        polygon.addListener("click", () => {
                            const infoContent = `
                                <h3>Class of the segment: ${areaData.class_id}</h3>
                            `;
                            document.getElementById("info-content").innerHTML = infoContent; // affiche le segment ID dans info-panel -> info-content
                            toggleInfoPanel(); // Open or hide the panel when an area is clicked

                            clickedPolygon = polygon;
                            clickedPixelMarkers = [];

                            // Récupérer les coordonnées du polygone cliqué
                            const polygonCoordinates = areaData.perimeter_pixel_coordinates.map(coord => ({
                                lat: parseFloat(coord.latitude),
                                lng: parseFloat(coord.longitude),
                                intensity: parseFloat(coord.intensity)
                            }));

                            // Loop through pixel_coordinates and display them on the map with dynamic alpha values
                            areaData.pixel_coordinates.forEach((pixelCoord, index) => {
                                const alpha = areaData.alphas[index];
                                const pixelMarker = new google.maps.Marker({
                                    position: new google.maps.LatLng(pixelCoord.latitude, pixelCoord.longitude),
                                    map: map,
                                    icon: {
                                        path: google.maps.SymbolPath.CIRCLE,
                                        fillColor: getColorFromAlpha(alpha),
                                        fillOpacity: 1,
                                        strokeWeight: 0,
                                        scale: 5
                                    }
                                });
                            });

                            // Calculer le centre géométrique du polygone
                            const centerLat = polygonCoordinates.reduce((sum, coord) => sum + coord.lat, 0) / polygonCoordinates.length;
                            const centerLng = polygonCoordinates.reduce((sum, coord) => sum + coord.lng, 0) / polygonCoordinates.length;

                            // Create a new map in the panel centered on the clicked area -> ON VEUT HEAT MAP
                            const mapOptions = {
                                center: new google.maps.LatLng(centerLat, centerLng),
                                zoom: 20,
                            };
                            mapInPanel = new google.maps.Map(document.getElementById("map-in-panel"), mapOptions);

                            if (mapInPanel) {

                                // Add the saved polygon to the existing map
                                if (clickedPolygon) {
                                    clickedPolygon.setMap(mapInPanel);
                                }

                                // Add the saved pixel markers to the existing map
                                clickedPixelMarkers.forEach(marker => {
                                    marker.setMap(mapInPanel);
                                });
                                }


                            // Add console.log for debugging
                            console.log('polygonCoordinates V0207:', polygonCoordinates);


                            // Obtenir les valeurs minimale et maximale des alpha pour la legende
                            const minIntensity = Math.min(...polygonCoordinates.map(coord => coord.alphas));
                            const maxIntensity = Math.max(...polygonCoordinates.map(coord => coord.alphas));

                            // Get unique alpha values and their associated colors for the clicked polygon
                            areaData.alphas.forEach((alpha, index) => {
                                uniqueAlphaColors[alpha] = uniqueAlphaColors[alpha] || getColorFromAlpha(alpha);
                            });


                            // Update the #legend-content with the unique alpha values and colored boxes
                            const legendContent = `
                                <h4>Attention Weight</h4>
                                <div id="alphalegend">
                                    ${Object.entries(uniqueAlphaColors).map(([alpha, color]) => `
                                        <span class="legend-color-box" style="background-color: ${color};"></span>
                                        <span>${alpha}</span>
                                    `).join('')}
                                </div>
                            `;
                            document.getElementById("legend").innerHTML = legendContent;
                        });
                    });
                })

                .catch(error => {
                    console.error('Error fetching data:', error);
                });

function toggleInfoPanel() {
    const infoPanel = document.getElementById("info-panel");
    infoPanelVisible = !infoPanelVisible;

    if (infoPanelVisible) {
        infoPanel.style.transform = "translateX(0)"; // Show the panel
    } else {
        infoPanel.style.transform = "translateX(100%)"; // Hide the panel
    }
}

// Function to fetch and concatenate multiple JSON files
        function fetchAndConcatJSON(filePaths) {
            return Promise.all(filePaths.map(filePath =>
                fetch(filePath)
                    .then(response => response.json())
            ))
            .then(jsonDataArray => jsonDataArray.flat());
        }

            const jsonFilesToFetch = [
                './sources/up_left_corner_segment_lat_long.json',
                './sources/water_segment_lat_long.json'
            ];

            // recupérer les coordonnées des segments à partir du fichier JSON water (requête fetch)
            fetchAndConcatJSON(jsonFilesToFetch)
                // convertit la réponse en JSON
                // .then(response => response.json())
                // traitement des données récupérées
                .then(data => {
                    // Loop through the data and create polygons for each area
                    data.forEach((areaData) => {
                        const polygonCoordinates = areaData.perimeter_pixel_coordinates.map(coord => ({
                            lat: parseFloat(coord.latitude),
                            lng: parseFloat(coord.longitude),
                            intensity: parseFloat(coord.intensity)
                        }));




AIzaSyBEKcJxXZ9Hr_T97zsoed5Q2RMX_5X1ph0